set(TEST_BIN all-tests)

file(GLOB_RECURSE tests LIST_DIRECTORIES false *.h *.cpp)
file(GLOB_RECURSE utils LIST_DIRECTORIES false ../util/*.h ../util/*.cpp)
file(GLOB_RECURSE io LIST_DIRECTORIES false ../io/*.h ../io/*.cpp)

set(SOURCES ${tests} ${utils} ${io})

add_executable(${TEST_BIN} ${tests} ${utils} ${io})
add_test(NAME ${TEST_BIN} COMMAND ${TEST_BIN})

target_link_libraries(${TEST_BIN} PUBLIC gtest)

add_custom_command(
  TARGET ${TEST_BIN}
  COMMAND ${CMAKE_COMMAND} -E copy
  ${CMAKE_CURRENT_SOURCE_DIR}/resources/test.cfg
  ${CMAKE_BINARY_DIR}/test/
)