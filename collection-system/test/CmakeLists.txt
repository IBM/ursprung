set(TEST_BIN all-tests)

file(GLOB_RECURSE tests LIST_DIRECTORIES false *.h *.cpp)
file(GLOB_RECURSE utils LIST_DIRECTORIES false ../util/*.h ../util/*.cpp)
file(GLOB_RECURSE io LIST_DIRECTORIES false ../io/*.h ../io/*.cpp)
file(GLOB_RECURSE sql LIST_DIRECTORIES false ../sql/*.h ../sql/*.cpp)
file(GLOB_RECURSE rules LIST_DIRECTORIES false ../rules/*.h ../rules/*.cpp)

set(SOURCES ${tests} ${utils} ${io} ${sql} ${rules})

add_executable(${TEST_BIN} ${tests} ${utils} ${io} ${sql} ${rules})
add_test(NAME ${TEST_BIN} COMMAND ${TEST_BIN})

target_include_directories(${TEST_BIN} PUBLIC /usr/local/include ../util ../io ../sql ../rules ../lib/c-hglib/hglib)
target_link_directories(${TEST_BIN} PUBLIC /usr/local/lib ${PROJECT_SOURCE_DIR}/lib/c-hglib)
target_link_libraries(${TEST_BIN} PUBLIC gtest odbc boost_regex hg)

add_custom_command(
  TARGET ${TEST_BIN}
  COMMAND ${CMAKE_COMMAND} -E copy
  ${CMAKE_CURRENT_SOURCE_DIR}/resources/test.cfg
  ${CMAKE_BINARY_DIR}/test/
)

add_custom_command(
  TARGET ${TEST_BIN}
  COMMAND ${CMAKE_COMMAND} -E copy
  ${CMAKE_CURRENT_SOURCE_DIR}/resources/test-file-in-stream
  ${CMAKE_BINARY_DIR}/test/
)